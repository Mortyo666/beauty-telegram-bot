# beauty-telegram-bot
Гибкий Telegram-бот для салонов красоты и отдельных мастеров: запись клиентов, управление услугами и товарами, напоминания, многоуровневая админка. Проект запускается в Docker и масштабируется под десятки и сотни инстансов без конфликтов, хранит записи в Google Sheets.

Важное: пользовательская навигация строится исключительно на визуальных кнопках (inline/reply). Текстовые команды для клиентов и мастеров не используются — только кнопки и сценарии.

## Ключевые фишки
- Простая установка: одна команда bash (wget | bash) с вашим TELEGRAM_BOT_TOKEN и OWNER_ID
- Из коробки Docker + docker-compose: изоляция и масштабируемость для множества салонов/мастеров
- Клиентские сценарии: запись/отмена, связь с мастером, заявки на продукцию — через кнопки
- Админ-панель: управление мастерами, продукцией, рассылки, блокировки — через кнопки
- Панель мастера: видит свои записи, пишет клиентам, управляет услугами и товарами — через кнопки
- Напоминания: за 2 дня и за 4 часа до визита
- Анти-флуд: лимит 2 записи в день на клиента, защита от массового бронирования
- Хранилище: Google Sheets (клиенты, визиты, услуги, мастера, заявки и покупки)
- Масштабируемая архитектура и понятная структура проекта

## Интерфейс (визуальная навигация на кнопках)
Навигация для всех ролей — только через inline/reply кнопки. Кнопка = действие. Никаких текстовых команд в пользовательских сценариях.

Роли:
- Клиент: записаться, отменить, мои визиты, связаться, товары.
- Мастер: мои записи, свободные слоты, услуги/товары, сообщения клиентам.
- Админ: мастера, услуги/товары, расписание, рассылки, блок-лист, настройки.

Примеры меню (текстовые макеты кнопок):

Клиент — Главное меню (reply):
[ Записаться ]  [ Мои визиты ]
[ Товары ]      [ Связаться ]

Клиент — «Записаться» (inline):
[ Выбрать услугу ] → [ Выбрать мастера ] → [ Выбрать дату ] → [ Выбрать время ]
[ Подтвердить запись ] | [ Назад ]

Клиент — «Мои визиты» (inline):
(Список будущих визитов)
Для каждой записи: [ Детали ] [ Перенести ] [ Отменить ]

Мастер — Главное меню (reply):
[ Мои записи ]  [ Свободные слоты ]
[ Услуги/Товары ] [ Сообщения клиентам ]

Мастер — «Мои записи» (inline):
(Список записей на дату)
[ Назад ] [ Предыдущий день ] [ Следующий день ]
В карточке визита: [ Написать клиенту ] [ Отметить выполнено ] [ Отменить ]

Админ — Главное меню (reply):
[ Мастера ]  [ Услуги/Товары ]
[ Расписание ] [ Рассылки ]
[ Блок-лист ] [ Настройки ]

Админ — «Мастера» (inline):
[ Добавить мастера ] [ Список мастеров ]
В карточке мастера: [ Включить/Выключить ] [ Редактировать ] [ Удалить ]

Сценарий «Запись клиента» (пошагово, только кнопки):
1) Клиент нажимает [ Записаться ]
2) Выбирает услугу из списка кнопок
3) Выбирает мастера (кнопки с именами и рейтингом)
4) Выбирает дату (пагинация по календарю кнопками)
5) Выбирает время (кнопки слотов)
6) Подтверждает [ Подтвердить запись ] или возвращается [ Назад ]
7) Получает чек-резюме и кнопку [ Добавить в календарь ]

Сценарий «Отмена/перенос визита»:
- Из «Мои визиты»: [ Перенести ] → повтор шага выбора даты/времени на кнопках; [ Отменить ] → подтверждение на кнопке [ Да, отменить ]

Сценарий «Товары»:
- [ Товары ] → категории (кнопки) → позиция → [ Оформить заявку ] → [ Отправить контакты ]

Технические детали UI:
- Inline клавиатуры: контекстные действия, пагинация, подтверждения, инлайн-фильтры
- Reply клавиатуры: главные/ролеовые меню для быстрого входа
- Состояния и хранение контекста: FSM, возврат назад через [ Назад ]
- Все критические операции имеют подтверждения на отдельных кнопках

Скриншоты/макеты (плейсхолдеры):
- docs/ui/client_main.png — Главное меню клиента
- docs/ui/booking_flow.png — Поток записи (услуга → мастер → дата → время)
- docs/ui/admin_main.png — Главное меню админа
(Если файлов нет, используйте текстовые макеты выше.)

## Планы по Telegram WebApp
- Встроенное WebApp-приложение для расширенных форм: календарь с быстрым пролистыванием, карточки услуг с фотографиями, корзина товаров
- Авторизация через initData, связь с ботом по chat_id и session
- Режимы: Client WebApp (запись/история/товары), Master WebApp (слоты/расписание/чат), Admin WebApp (каталоги/мастера/рассылки)
- Offline-кэш для последних данных и плавная деградация до кнопок
- UI-библиотека: Telegram Mini Apps + React/Vanilla, сборка через Vite
- Хостинг: GitHub Pages/Cloudflare Pages или отдельный статиκ + CDN, деплой из CI

## Установка за 1 команду
На сервере с Docker и docker-compose:
```
bash
bash -c "$(wget -qO- https://raw.githubusercontent.com/Mortyo666/beauty-telegram-bot/main/docker/init.sh)" \
  -- \
  --token "YOUR_TELEGRAM_BOT_TOKEN" \
  --owner "YOUR_TELEGRAM_USER_ID" \
  --sheet "YOUR_GOOGLE_SHEET_ID"
```
Скрипт:
- создаст .env
- развернёт docker-compose с сервисом бота
- выполнит первичную инициализацию Google Sheets

## Структура проекта (план)
- bot.py — точка входа бота (aiogram/ptb), роутинг хэндлеров кнопок
- config/
  - settings.py — чтение .env, конфигурация токенов/лимитов/таймингов
  - logging.py — логирование
- google_sheets/
  - client.py — авторизация (service account), обёртка над Google Sheets API
  - models.py — схемы таблиц (клиенты, визиты, мастера, услуги, товары, заявки)
  - repository.py — CRUD-операции
  - init_templates/ — шаблоны таблиц и диапазонов
- docker/
  - Dockerfile — образ бота (slim + non-root)
  - docker-compose.yml — сервисы bot + (опционально) scheduler/worker
  - init.sh — инсталлятор (wget | bash), генерация .env, запуск compose
- admin/
  - routes_admin.py — меню администратора (inline/reply)
  - routes_master.py — меню мастера (inline/reply)
  - acl.py — роли, доступы, блок-лист
- features/
  - booking/ — запись, отмена, слоты, напоминания, лимиты
  - products/ — товары, заявки, подтверждение покупки
  - messaging/ — рассылки, сообщения клиентам, связь с мастером
  - anti_flood/ — защита от спама, капча по необходимости
- ui/
  - keyboards.py — инлайн/реплай клавиатуры (единый стиль)
  - texts.py — тексты и локализация (RU, EN опционально)
- scripts/
  - migrate_sheets.py — инициализация/миграции структуры Google Sheets
  - seed_demo.py — демо-данные (пример салона/мастера/услуг)

## Google Sheets: схемы таблиц (план)
- Clients(id, tg_id, name, phone, notes)
- Visits(id, client_id, master_id, service_id, date, time, status)
- Masters(id, name, username, active)
- Services(id, name, price, duration, active)
- Products(id, name, price, stock, active)
- Orders(id, client_id, product_id, qty, status)

## Масштабирование
- Многоинстансовая схема (пер-салон/пер-мастер): изолированные .env и таблицы
- Шардинг по ботам/токенам и очередям напоминаний
- Идемпотентные операции и ретраи на Google API

## Дальнейшие улучшения
- Поддержка нескольких языков (i18n)
- Интеграция платежей в WebApp
- Авто-распознавание спама/мошенничества
